{{include  file="$smarty_root/header.html" }}
<link rel="stylesheet" media="screen" href="{{$rootpath}}/vendors/bootstrap-datepicker/css/datepicker.css">
<link rel="stylesheet" media="screen" href="{{$rootpath}}/css/datepicker.fixes.css">
<script type="text/javascript" src="{{$rootpath}}/vendors/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="{{$rootpath}}/vendors/html2canvas/dist/html2canvas.js"></script>
<style>
    #box {
        min-height: 320px;
        background-color: #ffffff;
        border: solid 1px #cccccc;
        border-radius: 4px;
    }

        #box .bar {
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 15px;
            margin-right: 15px;
            background-color: #89B0D8;
            border: solid 1px #89B0D8;
            border-radius: 4px;
            height: 20px;
            color: #ffffff;
        }

            #box .bar .bartitle {
                padding-left: 25px;
            }

            #box .bar .dot {
                background-color: #ffffff;
                border: solid 1px #ffffff;
                border-radius: 10px;
                height: 10px;
                width: 10px;
                color: #ffffff;
                margin-top: 4px;
                margin-left: 10px;
                float: left;
            }

        #box .title {
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
        }

        #box #formtable {
            margin-top: 7px;
            width: 660px;
            margin-left: 15px;
        }

            #box #formtable input {
                border: 0px;
                border-color: #ffffff;
                text-align: center;
            }

            #box #formtable select {
                border: 0px;
                border-color: #ffffff;
                text-align: center;
            }

            #box #formtable td {
                width: 110px;
                height: 30px;
            }

        #box .fieldset {
            margin-top: 10px;
        }

        #box .fieldname, .field {
            padding-left: 0px;
            padding-right: 0px;
        }

        #box input, select {
            padding-left: 5px;
            width: 80%;
            border: solid 1px #9DCDD2;
        }

        #box .result {
            padding-left: 45px;
            margin-top: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        #box .content {
            padding-left: 75px;
            padding-right: 75px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
</style>
<div class="row">
    <div class="col-md-3 ">
        {{include  file="$smarty_root/Member/menu.html" }}
    </div>
    <div class="col-md-9">
        <div class="row">
            <div class="col-md-12 ">
                <div id="box">
                    <div class="row bar">
                        <div class="dot"></div>
                        <div class="small bartitle">家庭医生服务管理中心</div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center title">
                            远程会诊报告单
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-right small" style="padding-right:30px;">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <table id="formtable" border="1">
                                <tr>
                                    <td>申请单位:</td>
                                    <td colspan="3">{{$info.hospital}}</td>
                                    <td>申请日期:</td>
                                    <td>{{$info.meeting_date}}</td>
                                </tr>
                                <tr>
                                    <td>患者姓名:</td>
                                    <td><input type="text" class="notnull" id="name" value="{{$info.name}}" /></td>
                                    <td>性别:</td>
                                    <td>{{if $info.sexual=='M' }}男{{else}}女{{/if}}</td>
                                    <td>申请年龄:</td>
                                    <td>{{$info.age}}</td>
                                </tr>
                                <tr>
                                    <td>会诊类别：</td>
                                    <td>{{$info.category}}</td>
                                    <td>会诊方式：</td>
                                    <td>{{$info.way}}</td>
                                    <td>紧急程度：</td>
                                    <td>{{$info.urgent}}</td>
                                </tr>
                                <tr>
                                    <td>专家要求:</td>
                                    <td colspan="3">{{$info.necessary}}</td>
                                    <td>会诊日期:</td>
                                    <td>{{$info.apply_date}}</td>
                                </tr>
                                <tr style="height:60px;">
                                    <td>初步诊断:</td>
                                    <td colspan="5">{{$info.apply_first_result}}</td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <div class="col-md-8 text-left">
                                            服务方医院: {{$info.apply_hospital}}
                                        </div>
                                        <div class="col-md-4 text-right">
                                            服务方科室: {{$info.apply_department}}
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="row">
                            <div class="col-md-12 result" style="margin-top:20px;">
                                病情分析
                            </div>
                            <div class="col-md-12  content">
                                <p>{{$info.result}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 result">
                                临床诊断
                            </div>
                            <div class="col-md-12  content">
                                <p>{{$info.checking}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 result">
                                治疗方案
                            </div>
                            <div class="col-md-12  content">
                                <p>{{$info.solution}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 result">
                                注意事项
                            </div>
                            <div class="col-md-12  content">
                                <p>{{$info.caution}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12" style="margin-top:20px;">
                <div class="row text-center">
                    {{if $info.status=='F'}}
                    <button class="btn btn-success " id="btnDownload">下载报告</button>
                    {{/if}}
                    {{if $info.status=='F'}}
                    <button class="btn btn-success " id="btnPrint">打印报告</button>
                    {{/if}}
                </div>
                <div class="row  text-center" style="">
                    <div class="col-md-12" style="color:red" id="tips">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {


        $('.datepicker').datepicker({ format: "yyyy-mm-dd" });
        $("#btnReturn").click(function () {
            window.location.href = "{{$rootpath}}/Member/filelist.php";
        });
        $("#btnAbandon").click(function () {
            var caselist = "{{$info.id}}";

            if (confirm("确定要作废当前病历吗？")) {
                var json = {
                    "action": "submit",
                    "caselist": caselist
                };
                $("#btnAbandon").addClass("disabled");
                $.post("{{$rootpath}}/Member/caselist.php", json, function (data) {
                    if (data == "RIGHT") {
                        window.history.go(-1);
                    } else {
                        alert(data);
                    }

                    $("#btnAbandon").removeClass("disabled");
                });
            }
        });
        $("#btnSave").click(function () {
            var allnotnull = true;

            $("#box .notnull").each(function (index) {
                if ($.trim($(this).val()) == "") {
                    allnotnull = false;
                    $(this).css("border-bottom", "1px solid red");
                } else {
                    $(this).css("border-bottom", "0px solid red");
                }
            });

            if (allnotnull == false) {
                $("#tips").text("红色下划线处为必填项，请录入后再修改");
                return;
            }


            var json = {
                "action": "submit",
                "id": "{{$info.id}}"
            };
            $("#box input,select").each(function (index) {
                var key = $(this).attr("id");
                var val = $(this).val();
                json[key] = val;
            });
            $("#btnSave").addClass("disabled");
            $("#input").addClass("disabled");
            $.post("{{$rootpath}}/Member/case.php", json, function (data) {
                if (data == "RIGHT") {
                    window.location.href = "{{$rootpath}}/Member/case.php?id={{$info.id}}";
                } else {
                    alert(data);
                }
                $("#btnSave").removeClass("disabled");
                $("#input").removeClass("disabled");
            });
        });
    });
</script>
{{include  file="$smarty_root/footer.html" }}
